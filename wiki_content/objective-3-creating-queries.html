<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Objective 3 - Creating Queries</title>
<meta name="identifier" content="g34db03e4814fa0e25e5dde81325286e1"/>
<meta name="editing_roles" content="teachers"/>
<meta name="workflow_state" content="active"/>
</head>
<body>
<div class=" border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>Overview</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<p>In this objective we delve into how RTK Query enables us to retrieve data using simple yet powerful query definitions. We'll flesh out our usersApi slice to include a query endpoint for fetching user data and then utilize this in a component to display a list of users.</p>
</div>
<div class="border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>How to Build It</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<h4><strong>Defining a Query Endpoint</strong></h4>
<p><span>We expand our </span><code>usersApi</code><span> slice by adding a query endpoint. This endpoint represents a specific data retrieval operationâ€”fetching users in this case. We define a query function that tells RTK Query what to fetch and how to fetch it.</span></p>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// frontend/state/usersApi.js</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> { createApi, fetchBaseQuery } <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'@reduxjs/toolkit/query/react'</span><br><br><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// This is the centralized API slice for user-related data fetching</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> usersApi = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">createApi</span>({<br>&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Identifies the API slice's place in the global state structure</span><br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">reducerPath</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'usersApi'</span>,<br>&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Sets up the base query with the root URL to the backend server</span><br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">baseQuery</span>: <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">fetchBaseQuery</span>({ <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">baseUrl</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'http://localhost:9009/api/'</span> }),<br>&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// The endpoints represent operations our components can invoke</span><br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">endpoints</span>: <span><span>builder</span> =&gt;</span> ({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// 'getUsers' is a query operation to fetch user data</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">getUsers</span>: builder.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">query</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Pointing to the 'users' endpoint on our server</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">query</span>: <span>() =&gt;</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'users'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;})<br>})<br><br><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Auto-generated hook for the 'getUsers' query</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> {<br>&nbsp;&nbsp;useGetUsersQuery,<br>} = usersApi</code><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><br></code></pre>
<h4><strong>Consuming the Query in a Component</strong></h4>
<p><span>With the query endpoint in place, we can now use the auto-generated </span><code>useGetUsersQuery</code><span> hook in our components. This hook takes care of the data fetching lifecycle, including loading and error states.</span></p>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// frontend/components/App.js</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">React</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'react'</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> { useGetUsersQuery } <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'../state/usersApi'</span><br><br><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// This component displays a list of users utilizing data fetched with RTK Query</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">default</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">function</span> <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">Todo</span>() {<br>&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Destructuring 'data' from the query hook, aliased as 'users' for clarity</span><br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> { <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">data</span>: users } = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">useGetUsersQuery</span>()<br><br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">return</span> (<br>&nbsp;&nbsp;&nbsp;&nbsp;<span><span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h2</span>&gt;</span>Users<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h2</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h3</span>&gt;</span>Managed with RTK Query<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h3</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">ul</span>&gt;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Rendering a list item for each user if the data is available<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users?.map(user =&gt; (<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span> <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">key</span>=<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">{user.id}</span>&gt;</span>{user.username}<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">ul</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span></span><br>&nbsp;&nbsp;)<br>}</code><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><br></code></pre>
<h4><strong>Visualizing the Data</strong></h4>
<p>Once the <code>Todo</code> component mounts, <code>useGetUsersQuery</code> is invoked, initiating the data fetching process. The list of users is then rendered on the screen as soon as the data is available, demonstrating the seamless integration of data fetching with RTK Query.</p>
</div>
<div class="border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>Video Walkthrough</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<p><iframe class="wistia_embed" title="Understanding Redux" src="https://fast.wistia.net/embed/iframe/859bepz3iy?seo=false&amp;videoFoam=false" width="640" height="360" name="wistia_embed" allow="autoplay; fullscreen" loading="lazy"></iframe></p>
</div>
</body>
</html>