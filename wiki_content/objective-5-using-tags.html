<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Objective 5 - Using Tags</title>
<meta name="identifier" content="g340d89e34d9b0943c2f6aa816bf82a81"/>
<meta name="editing_roles" content="teachers"/>
<meta name="workflow_state" content="active"/>
</head>
<body>
<div class=" border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>Overview</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<p><span>In this objective, we're exploring the use of 'tags' in RTK Query. Tags are a feature of RTK Query that facilitate automatic re-fetching of data when performing actions that may change the data on the server side, such as mutations. This is part of RTK Query's advanced cache management capabilities, ensuring that the UI is kept up-to-date with the latest server state</span>.</p>
</div>
<div class="border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>How to Build It</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<h4><strong>What are Tags?</strong></h4>
<p>Tags in RTK Query are identifiers associated with query results. They play a crucial role in cache invalidation strategies, which determine when to fetch fresh data. Here's a quick breakdown:</p>
<ul>
<li>
<p><code>providesTags</code>: This is used in a query to define which tags the query's result will provide. When data is fetched using this query, RTK Query will keep track of the provided tag as being "available".</p>
</li>
<li>
<p><code>invalidatesTags</code>: Used in a mutation to specify which tags should be invalidated when the mutation is successfully executed. If a mutation invalidates a tag, RTK Query will mark it as "outdated", and any queries providing that tag will be re-fetched to provide fresh data.</p>
</li>
</ul>
<h4><strong>Adding Tags to Our Endpoints</strong></h4>
<p><span>We'll modify our </span><code>usersApi</code><span> service to utilize tags for cache control. By specifying </span><code>providesTags</code><span> in the </span><code>getUsers</code><span> query and </span><code>invalidatesTags</code><span> in the </span><code>createUser</code><span> mutation, we inform RTK Query about the relationships between our operations and the cached data.</span></p>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// frontend/state/usersApi.js</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> { createApi, fetchBaseQuery } <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'@reduxjs/toolkit/query/react'</span><br><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> usersApi = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">createApi</span>({<br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">reducerPath</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'usersApi'</span>,<br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">baseQuery</span>: <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">fetchBaseQuery</span>({ <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">baseUrl</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'http://localhost:9009/api/'</span> }),<br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">tagTypes</span>: [<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'Users'</span>], <span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Declaring the types of tags we'll use for invalidation</span><br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">endpoints</span>: <span><span>builder</span> =&gt;</span> ({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">getUsers</span>: builder.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">query</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">query</span>: <span>() =&gt;</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'users'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">providesTags</span>: [<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'Users'</span>], <span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// The 'getUsers' query provides the 'Users' tag</span><br>&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">createUser</span>: builder.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">mutation</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">query</span>: <span><span>username</span> =&gt;</span> ({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">url</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'users'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">method</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'POST'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">body</span>: { username },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">invalidatesTags</span>: [<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'Users'</span>], <span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Invalidate 'Users' tag upon mutation</span><br>&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;}),<br>})<br><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> {<br>&nbsp;&nbsp;useGetUsersQuery,<br>&nbsp;&nbsp;useCreateUserMutation,<br>} = usersApi</code><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><br></code></pre>
<h4><strong>Using Tagged Endpoints in Components</strong></h4>
<p><span>Within our components, we use the queries and mutations just as before, but now RTK Query will automatically re-fetch the </span><code>getUsers</code><span> query whenever we call the </span><code>createUser</code><span> mutation, thanks to the tags.</span></p>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// frontend/components/App.js</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">React</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'react'</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> { useGetUsersQuery, useCreateUserMutation } <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'../state/usersApi'</span><br><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">default</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">function</span> <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">App</span>() {<br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> { <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">data</span>: users } = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">useGetUsersQuery</span>()<br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> [createUser] = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">useCreateUserMutation</span>()<br><br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">return</span> (<br>&nbsp;&nbsp;&nbsp;&nbsp;<span><span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h2</span>&gt;</span>Users<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h2</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h3</span>&gt;</span>Managed with RTK Query<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h3</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">ul</span>&gt;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users?.map(user =&gt; (<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span> <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">key</span>=<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">{user.id}</span>&gt;</span>{user.username}<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">ul</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">button</span> <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">onClick</span>=<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">{()</span> =&gt;</span> createUser('New User')}&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add New User<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">button</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span></span><br>&nbsp;&nbsp;)<br>}</code><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><br></code></pre>
<h4><strong>The Power of Tags</strong></h4>
<p><span>By leveraging tags, we greatly simplify the logic around maintaining fresh data within our application. With RTK Query handling the complexities of invalidating and re-fetching queries, developers can focus more on building out the UI and user experience, trusting that the data presented is current and consistent with the server state.</span></p>
<p><span>Understanding and using tags is a powerful aspect of RTK Query that optimizes data synchronization across our application. It's an example of how RTK Query abstracts away complex caching logic and provides developers with intuitive tools to maintain data consistency.</span></p>
</div>
<div class="border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>Video Walkthrough</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<p><iframe class="wistia_embed" title="Understanding Redux" src="https://fast.wistia.net/embed/iframe/nggaw17zwr?seo=false&amp;videoFoam=false" width="640" height="360" name="wistia_embed" allow="autoplay; fullscreen" loading="lazy"></iframe></p>
</div>
</body>
</html>