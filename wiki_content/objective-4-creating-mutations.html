<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Objective 4 - Creating Mutations</title>
<meta name="identifier" content="ge69193b2cfde06f14f5c19335facb8fd"/>
<meta name="editing_roles" content="teachers"/>
<meta name="workflow_state" content="active"/>
</head>
<body>
<div class=" border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>Overview</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<p><span>"Creating Mutations" guides us through the process of altering server-side data using RTK Query. Unlike queries, which request data without causing changes to the server state, mutations are used for creating, updating, or deleting dataâ€”essentially any operation that modifies server-side data. This module teaches how to define and use mutations within our application.</span></p>
</div>
<div class="border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>How to Build It</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<h4><strong>Understanding Queries vs. Mutations</strong></h4>
<p>Before diving into the code, let's clarify the difference between queries and mutations within the context of RTK Query and data fetching:</p>
<ul>
<li><strong>Queries</strong> are operations that retrieve data from an API without causing side effects. They are meant for "GET" operations and are typically used to sync the server state with the client.</li>
<li><strong>Mutations</strong>, on the other hand, are operations that modify server-side data. They encompass "POST", "PUT", "PATCH", or "DELETE" operations and often result in changes to the data the server returns.</li>
</ul>
<p>The distinction is crucial for understanding how to structure interactions with an API in a Redux application.</p>
<h4><strong>Setting Up a Mutation Endpoint</strong></h4>
<p><span>Building on our existing </span><code>usersApi</code><span>, we add a mutation endpoint. This </span><code>createUser</code><span> mutation allows us to send a new user's username to the server, requesting the creation of a new user entity.</span></p>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// src/api/usersApi.js</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> { createApi, fetchBaseQuery } <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'@reduxjs/toolkit/query/react'</span>;<br><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> usersApi = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">createApi</span>({<br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">reducerPath</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'usersApi'</span>,<br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">baseQuery</span>: <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">fetchBaseQuery</span>({ <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">baseUrl</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'http://localhost:9009/api/'</span> }),<br>&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">endpoints</span>: <span><span>builder</span> =&gt;</span> ({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">getUsers</span>: builder.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">query</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">query</span>: <span>() =&gt;</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'users'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">createUser</span>: builder.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">mutation</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Specifies the query for the mutation, including the URL, HTTP method, and body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">query</span>: <span><span>username</span> =&gt;</span> ({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">url</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'users'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">method</span>: <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'POST'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">body</span>: { username },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;&nbsp;&nbsp;}),<br>&nbsp;&nbsp;}),<br>})<br><br><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// Hooks automatically generated by RTK Query for our endpoints</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> {<br>&nbsp;&nbsp;useGetUsersQuery,<br>&nbsp;&nbsp;useCreateUserMutation,<br>} = usersApi<br></code></pre>
<h4><strong>Implementing Mutations in Components</strong></h4>
<p><span>With the mutation endpoint ready, we employ the </span><code>useCreateUserMutation</code><span> hook in our </span><code>App</code><span> component. This hook provides us with a </span><code>create</code><span> function that we can call to trigger the mutation.</span></p>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;"><span style="border: 0px none #6a737d; color: #6a737d; text-decoration: none solid #6a737d;">// src/components/App.js</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">React</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'react'</span><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">import</span> { useGetUsersQuery, useCreateUserMutation } <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">from</span> <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'../state/usersApi'</span><br><br><span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">export</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">default</span> <span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">function</span> <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">App</span>() {<br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> { <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">data</span>: users } = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">useGetUsersQuery</span>()<br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">const</span> [createUser] = <span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">useCreateUserMutation</span>()<br><br>&nbsp;&nbsp;<span style="border: 0px none #d73a49; color: #d73a49; text-decoration: none solid #d73a49;">return</span> (<br>&nbsp;&nbsp;&nbsp;&nbsp;<span><span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h2</span>&gt;</span>Users<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h2</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h3</span>&gt;</span>Managed with RTK Query<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">h3</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">ul</span>&gt;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users?.map(user =&gt; (<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span> <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">key</span>=<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">{user.id}</span>&gt;</span>{user.username}<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">ul</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/* Button to trigger the mutation */}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">button</span> <span style="border: 0px none #005cc5; color: #005cc5; text-decoration: none solid #005cc5;">onClick</span>=<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">{()</span> =&gt;</span> createUser('Test User')}&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create test user<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">button</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span style="border: 0px none #22863a; color: #22863a; text-decoration: none solid #22863a;">div</span>&gt;</span></span><br>&nbsp;&nbsp;)<br>}<br></code></pre>
<p>The <code>createUser</code> function can be called with the new user's username as an argument. When invoked, it performs a "POST" request to the server's 'users' endpoint, which is expected to handle the user creation logic.</p>
<p><span>When we call </span><code>createUser</code><span>, RTK Query automatically manages the lifecycle of the mutation. It optimizes the request process, handles potential loading states, and updates the cache upon completion. This way, the component stays declarative, and the data flow remains clear and predictable.</span></p>
</div>
<div class="border border-trbl" style="background-color: #00808c; color: #ffffff; padding: 2px 10px; border: 1px solid black;">
<h3><strong>Video Walkthrough</strong></h3>
</div>
<div class="content-box pad-box-mini border border-rbl">
<p><iframe class="wistia_embed" title="Understanding Redux" src="https://fast.wistia.net/embed/iframe/0tlv7qs8md?seo=false&amp;videoFoam=false" width="640" height="360" name="wistia_embed" allow="autoplay; fullscreen" loading="lazy"></iframe></p>
</div>
</body>
</html>